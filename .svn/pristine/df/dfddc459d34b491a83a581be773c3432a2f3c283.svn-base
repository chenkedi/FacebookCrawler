package api.facebook.daoImpl;

import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.List;

import javax.sql.DataSource;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.jdbc.core.RowMapper;
import org.springframework.stereotype.Repository;

import api.facebook.bean.Seeds;
import api.facebook.dao.SeedsDao;


//public class SeedsDaoImpl extends JdbcDaoSupport implements SeedsDao
@Repository
public class SeedsDaoImpl implements SeedsDao
{
	private JdbcTemplate jdbcTemplate;
	
	@Autowired
	 public void setDataSource(DataSource dataSource) {
        this.jdbcTemplate = new JdbcTemplate(dataSource);
    }
	
	/**
	 * Spring JdbcTemplate查询方法，query获得多行结果，queryForObject获得一行结果
	 */
	@Override
	public List<Seeds> readSeeds(int num) {
		final String SQL_SELECT_SEED=
				"SELECT seeds_id,user_name,name FROM seeds WHERE facebook_id IS NULL ORDER BY seeds_id ASC LIMIT "+num;
		List<Seeds> seed=jdbcTemplate.query(
				SQL_SELECT_SEED,
				new RowMapper<Seeds>(){
					public Seeds  mapRow(ResultSet rs,int rowNum) throws SQLException{
						Seeds seed=new Seeds();
						seed.setUserName(rs.getString("user_name"));
						seed.setSeedsId(rs.getInt("seeds_id"));
						seed.setName(rs.getString("name"));
						return seed;
					}
				});
		return seed;
	}

	
	@Override
	public void addSeedsInfo(Seeds seed,int seeds_id) {
		final String SQL_Insert_SEED=
				"UPDATE seeds set facebook_id=?,about=?,bio=?,birthday=?,category=?,hometown=?,likes=?,link=?,page_name=?,website=? WHERE seeds_id=?";
		jdbcTemplate.update(
				SQL_Insert_SEED,
				seed.getFacebookId(),
				seed.getAbout(),
				seed.getBio(),
				seed.getBirthday(),
				seed.getCategory(),
				seed.getHometown(),
				seed.getLikes(),
				seed.getLink(),
				seed.getPageName(),
				seed.getWebsite(),
				seeds_id);
		
	}

	@Override
	public List<Seeds> readSeedsForPosts(int num) {
		String SQL_SELECT_SEED=
				"SELECT seeds_id,user_name,name FROM seeds WHERE crawed_posts=0 ORDER BY seeds_id ASC LIMIT "+num;
		List<Seeds> seed=jdbcTemplate.query(
				SQL_SELECT_SEED,
				new RowMapper<Seeds>(){
					public Seeds  mapRow(ResultSet rs,int rowNum) throws SQLException{
						Seeds seed=new Seeds();
						seed.setUserName(rs.getString("user_name"));
						seed.setSeedsId(rs.getInt("seeds_id"));
						seed.setName(rs.getString("name"));
						return seed;
					}
				});
		return seed;
	}
	
	
}
